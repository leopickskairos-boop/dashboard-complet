# üéØ NOUVELLE FEATURE : MODULE MARKETING

## Contexte

On veut ajouter un module Marketing au dashboard SpeedAI qui permet √† nos clients (restaurants, garages, kin√©s...) de cr√©er et envoyer des campagnes Email + SMS √† leurs clients.

L'objectif est d'avoir :
1. Un **Mode Simple** : Campagne en 3 clics pour les clients press√©s
2. Un **Mode Avanc√©** : Studio complet pour ceux qui veulent personnaliser

---

## üìä SOURCES DE DONN√âES

### 1. Contacts automatiques (SpeedAI)
Tous les clients qui ont appel√©/r√©serv√© via l'agent SpeedAI sont d√©j√† dans notre syst√®me.

### 2. Int√©gration CRM (√† d√©velopper)
On veut pouvoir connecter le CRM de nos clients pour avoir plus de donn√©es :
- Zenchef, TheFork (restaurants)
- Doctolib (sant√©)
- Google Sheets (universel)
- Import CSV/Excel

### 3. Donn√©es √† stocker par contact
- Infos de base : nom, pr√©nom, email, t√©l√©phone
- Source : SpeedAI, CRM, Import
- Consentement : opt_in_email, opt_in_sms (RGPD)
- Stats : nombre de visites, derni√®re visite, panier moyen
- Tags : VIP, nouveau, inactif, etc.
- Pr√©f√©rences : jour pr√©f√©r√©, heure pr√©f√©r√©e, type de service

---

## üöÄ MODE SIMPLE : "Campagne en 3 clics"

### √âtape 1 : Choisir un template
L'utilisateur clique sur un type de campagne :
- üéÅ Offre promo (-X% ou -X‚Ç¨)
- üçΩÔ∏è Menu sp√©cial / Nouveaut√©
- üéÇ Anniversaire client
- üì¢ √âv√©nement / Actualit√©
- üíî R√©activation ("tu nous manques")
- ‚ú® Message libre

### √âtape 2 : Personnaliser (optionnel)
- Modifier le texte pr√©-rempli
- Changer le % de r√©duction
- Modifier la date de validit√©
- Pr√©visualisation Email + SMS en temps r√©el

### √âtape 3 : Choisir les destinataires
Options simples :
- "Tous mes clients" (X contacts)
- "Clients du mois" (X contacts)
- "Clients inactifs +30j" (X contacts)
- "Clients VIP" (X contacts)
- "Ciblage avanc√©..." ‚Üí bascule vers mode avanc√©

### √âtape 4 : Envoyer
- Choix du canal : Email, SMS, ou les deux
- Estimation du co√ªt (SMS payants)
- Envoi imm√©diat ou programm√©
- Bouton "Envoyer" ‚Üí Confirmation ‚Üí Done

---

## üé® MODE AVANC√â : "Studio Campagne"

### Cr√©ation
- √âditeur drag & drop pour les emails
- √âditeur SMS avec compteur de caract√®res
- Variables dynamiques : {pr√©nom}, {derni√®re_visite}, {restaurant}, etc.
- Import de templates HTML personnalis√©s

### Ciblage avanc√©
Filtres combinables :
- Fr√©quence de visite (> X fois par mois)
- Panier moyen (> X‚Ç¨)
- Type de service (d√©jeuner, d√Æner)
- Jour pr√©f√©r√© (week-end, semaine)
- Anciennet√© (client depuis > X mois)
- Sentiment (avis positif/n√©gatif)
- Tags personnalis√©s

### Tests
- A/B testing (2 versions, mesure du gagnant)
- Envoi test √† soi-m√™me
- Pr√©visualisation mobile/desktop

### Programmation
- Envoi imm√©diat
- Programm√© √† une date/heure
- R√©current (tous les lundis, chaque 1er du mois...)

---

## ü§ñ AUTOMATISATIONS (Phase future)

Campagnes d√©clench√©es automatiquement :

| Trigger | Action | D√©lai |
|---------|--------|-------|
| Nouveau client | Email bienvenue + code promo | Imm√©diat |
| Anniversaire | SMS/Email avec offre | J-3 |
| Client inactif 30j | "Vous nous manquez" + offre | Auto |
| Client inactif 60j | Relance + offre plus forte | Auto |
| Apr√®s visite | Demande d'avis (d√©j√† fait ‚úÖ) | H+2 |

S√©quences drip :
[Nouveau client] ‚Üí [Email bienvenue] ‚Üí J+7 [SMS rappel code] ‚Üí J+30 [Email r√©activation]

---

## üì± TEMPLATES PAR SECTEUR

### Restaurant
| Template | Message type |
|----------|--------------|
| üéÅ Offre du moment | "-X% ce week-end seulement !" |
| üçΩÔ∏è Nouveau menu | "D√©couvrez notre nouveau menu" |
| ü•Ç Happy Hour | "Happy Hour 17h-19h" |
| üéâ √âv√©nement | "Soir√©e sp√©ciale ce vendredi" |
| üíï Saint-Valentin | "Menu sp√©cial Saint-Valentin" |
| üéÇ Anniversaire | "Joyeux anniversaire ! Dessert offert" |
| üíî R√©activation | "√áa fait longtemps ! -15%" |

### Garage
| Template | Message type |
|----------|--------------|
| üîß R√©vision | "Il est temps de faire votre r√©vision" |
| üöó Contr√¥le technique | "CT √† faire ? -20‚Ç¨" |
| ‚ùÑÔ∏è Pneus hiver | "Montage pneus offert" |

### Kin√© / Sant√©
| Template | Message type |
|----------|--------------|
| üìÖ Rappel RDV | "Pensez √† prendre RDV" |
| üÜï Nouveau service | "D√©couvrez notre nouveau soin" |

---

## üìà ANALYTICS & TRACKING

### M√©triques par campagne
- Nombre d'envois (succ√®s/√©chec)
- Taux d'ouverture (email)
- Taux de clic
- Taux de conversion (r√©servation dans les 7 jours)
- CA attribu√© (si r√©servation apr√®s campagne)
- D√©sabonnements

### Dashboard stats
- Vue globale : envois, ouvertures, clics, conversions du mois
- Comparaison avec mois pr√©c√©dent
- Top campagnes par performance
- √âvolution dans le temps

### Attribution
Quand un client re√ßoit une campagne puis r√©serve dans les X jours, on attribue la conversion √† cette campagne.

---

## üóÑÔ∏è STRUCTURE BASE DE DONN√âES SUGG√âR√âE
```sql
-- Contacts marketing
marketing_contacts (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),  -- Le client SpeedAI
  email VARCHAR,
  phone VARCHAR,
  first_name VARCHAR,
  last_name VARCHAR,
  source VARCHAR,  -- 'speedai', 'crm', 'import', 'manual'
  opt_in_email BOOLEAN DEFAULT true,
  opt_in_sms BOOLEAN DEFAULT true,
  tags TEXT[],
  total_visits INTEGER DEFAULT 0,
  last_visit_at TIMESTAMP,
  avg_spend DECIMAL,
  preferred_day VARCHAR,
  preferred_time VARCHAR,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- Segments (groupes de contacts)
marketing_segments (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  name VARCHAR,
  filters JSONB,  -- {"visits_min": 2, "inactive_days": 30, ...}
  auto_update BOOLEAN DEFAULT true,
  contact_count INTEGER,
  created_at TIMESTAMP
)

-- Campagnes
marketing_campaigns (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  name VARCHAR,
  type VARCHAR,  -- 'promo', 'event', 'reactivation', 'birthday', 'custom'
  status VARCHAR,  -- 'draft', 'scheduled', 'sending', 'sent', 'cancelled'
  channel VARCHAR,  -- 'email', 'sms', 'both'
  
  -- Contenu
  email_subject VARCHAR,
  email_content TEXT,  -- HTML
  sms_content VARCHAR(480),
  
  -- Ciblage
  segment_id UUID REFERENCES marketing_segments(id),
  target_all BOOLEAN DEFAULT false,
  
  -- Planification
  scheduled_at TIMESTAMP,
  sent_at TIMESTAMP,
  
  -- Stats
  total_recipients INTEGER,
  total_sent INTEGER,
  total_opened INTEGER,
  total_clicked INTEGER,
  total_converted INTEGER,
  total_unsubscribed INTEGER,
  
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- Envois individuels (pour tracking)
marketing_sends (
  id UUID PRIMARY KEY,
  campaign_id UUID REFERENCES marketing_campaigns(id),
  contact_id UUID REFERENCES marketing_contacts(id),
  channel VARCHAR,  -- 'email' ou 'sms'
  status VARCHAR,  -- 'pending', 'sent', 'delivered', 'failed', 'bounced'
  sent_at TIMESTAMP,
  opened_at TIMESTAMP,
  clicked_at TIMESTAMP,
  converted_at TIMESTAMP,
  conversion_value DECIMAL,  -- CA g√©n√©r√©
  unsubscribed_at TIMESTAMP,
  error_message TEXT
)

-- Templates
marketing_templates (
  id UUID PRIMARY KEY,
  user_id UUID,  -- NULL = template syst√®me
  name VARCHAR,
  category VARCHAR,  -- 'promo', 'event', 'birthday', etc.
  business_type VARCHAR,  -- 'restaurant', 'garage', 'kine', 'all'
  channel VARCHAR,
  subject VARCHAR,
  content TEXT,
  variables TEXT[],  -- ['{pr√©nom}', '{restaurant}', '{code_promo}']
  is_system BOOLEAN DEFAULT false,
  created_at TIMESTAMP
)

-- Automatisations (phase future)
marketing_automations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  name VARCHAR,
  trigger_type VARCHAR,  -- 'new_client', 'birthday', 'inactive', 'post_visit'
  trigger_config JSONB,
  actions JSONB,  -- [{type: 'email', template_id: '...', delay: '0'}, ...]
  is_active BOOLEAN DEFAULT false,
  created_at TIMESTAMP
)
```

---

## üîå INT√âGRATIONS TECHNIQUES

### Email : Brevo (ex-Sendinblue)
- API fran√ßaise, RGPD compliant
- Gratuit jusqu'√† 300 emails/jour
- Tracking ouvertures/clics int√©gr√©
- Templates responsive

### SMS : Twilio (d√©j√† en place)
- On utilise d√©j√† Twilio pour les confirmations
- R√©utiliser les m√™mes credentials

### CRM (√† prioriser)
1. Google Sheets (sync simple, universel)
2. Zenchef API (restaurants)
3. Import CSV/Excel

---

## üí∞ MOD√àLE √âCONOMIQUE

### Option A : Inclus dans l'abonnement
- X emails/mois inclus (ex: 5000)
- X SMS/mois inclus (ex: 100)
- Au-del√† : facturation √† l'usage

### Option B : Packs s√©par√©s
- Pack SMS : 500 = 25‚Ç¨, 1000 = 40‚Ç¨
- Pack Email : 10000 = 20‚Ç¨