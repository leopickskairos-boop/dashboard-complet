# ğŸ§© OBJECTIF
Ajoute dans lâ€™interface dâ€™administration `/admin` de SpeedAI une **barre de recherche** permettant de filtrer les utilisateurs par email en temps rÃ©el.  
Lâ€™admin peut taper une partie dâ€™un email pour trouver un utilisateur prÃ©cis (ex: â€œleo@â€, â€œgmail.comâ€, etc.).  
Les rÃ©sultats doivent sâ€™actualiser automatiquement sans recharger la page.

---

## ğŸ§± BACKEND (Next.js API Route)
Modifie le fichier `/pages/api/admin/users.js` :

```js
import { getServerSession } from "next-auth";
import prisma from "@/lib/prisma";
import { requireAdmin } from "@/lib/requireAdmin";

export default async function handler(req, res) {
  const session = await getServerSession(req);
  requireAdmin(session, res);

  const { search } = req.query;

  try {
    const users = await prisma.user.findMany({
      where: search
        ? { email: { contains: search, mode: "insensitive" } }
        : {},
      select: {
        id: true,
        email: true,
        plan: true,
        status: true,
        lastActivity: true,
      },
      orderBy: { createdAt: "desc" },
      take: 50, // SÃ©curitÃ© : limite les rÃ©sultats
    });

    res.status(200).json(users);
  } catch (err) {
    console.error("Erreur /api/admin/users:", err);
    res.status(500).json({ error: "Erreur serveur" });
  }
}
```

---

## ğŸ¨ FRONTEND (React / Next.js â€” fichier `AdminDashboard.jsx` ou Ã©quivalent)
Ajoute une **barre de recherche dynamique** au-dessus du tableau :

```jsx
import { useState, useEffect } from "react";

export default function AdminDashboard() {
  const [users, setUsers] = useState([]);
  const [search, setSearch] = useState("");

  useEffect(() => {
    const fetchUsers = async () => {
      const res = await fetch(`/api/admin/users?search=${search}`);
      const data = await res.json();
      setUsers(data);
    };
    fetchUsers();
  }, [search]);

  return (
    <div className="p-6">
      <div className="mb-4 flex justify-between items-center">
        <h1 className="text-2xl font-bold">Gestion des utilisateurs</h1>
        <input
          type="text"
          placeholder="ğŸ” Rechercher un email..."
          className="border border-gray-300 rounded-lg px-3 py-2 w-80 focus:ring-2 focus:ring-blue-500"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
        />
      </div>

      {/* Tableau utilisateur */}
      <table className="w-full text-sm border-collapse">
        <thead>
          <tr className="border-b bg-gray-50 text-left">
            <th className="p-2">Email</th>
            <th className="p-2">Plan</th>
            <th className="p-2">Statut</th>
            <th className="p-2">DerniÃ¨re activitÃ©</th>
          </tr>
        </thead>
        <tbody>
          {users.length > 0 ? (
            users.map((u) => (
              <tr key={u.id} className="border-b hover:bg-gray-50">
                <td className="p-2">{u.email}</td>
                <td className="p-2">{u.plan}</td>
                <td className="p-2">{u.status}</td>
                <td className="p-2">{u.lastActivity}</td>
              </tr>
            ))
          ) : (
            <tr>
              <td colSpan="4" className="text-center py-4 text-gray-500">
                Aucun utilisateur trouvÃ©.
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}
```

---

## ğŸ” SÃ‰CURITÃ‰
- La route `/api/admin/users` reste protÃ©gÃ©e par le middleware `requireAdmin()`.
- La recherche est insensible Ã  la casse (`mode: "insensitive"`).
- Les rÃ©sultats sont limitÃ©s Ã  50 pour Ã©viter les abus.
- Les donnÃ©es sensibles (clÃ©s API, tokens) ne sont pas exposÃ©es.

---

## âœ… TEST FINAL
1. RedÃ©marre ton Replit.  
2. Connecte-toi en admin â†’ `/admin`.  
3. Tape un email partiel dans la barre de recherche.  
4. VÃ©rifie que les rÃ©sultats sâ€™affichent instantanÃ©ment.

Si tout fonctionne, affiche dans la console :
```
âœ… Recherche email admin opÃ©rationnelle
```
