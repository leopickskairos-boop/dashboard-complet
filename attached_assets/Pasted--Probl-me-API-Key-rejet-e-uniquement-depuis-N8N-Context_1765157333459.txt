ğŸ› ProblÃ¨me : API Key rejetÃ©e uniquement depuis N8N
Contexte
L'endpoint /api/webhooks/n8n fonctionne parfaitement avec un curl direct, mais retourne 401 "Invalid API key" quand la requÃªte vient de N8N.
Ce qui fonctionne âœ…
bashcurl -X POST "https://vocal-dash-leosedilleau41.replit.app/api/webhooks/n8n" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer speedai_live_238bc33272d57033cb5b0536f1d5db7ab839d591c440ec876ef06f480ff43205" \
  -d '{"call_id": "test", "agent_id": "agent_24572fd2ed314b65ce45b3240f"}'
â†’ RÃ©ponse : OK âœ…
Ce qui ne fonctionne pas âŒ
La mÃªme requÃªte envoyÃ©e depuis N8N avec :

URL : https://vocal-dash-leosedilleau41.replit.app/api/webhooks/n8n
Header : Authorization: Bearer speedai_live_238bc33272d57033cb5b0536f1d5db7ab839d591c440ec876ef06f480ff43205
Body : JSON identique

â†’ RÃ©ponse : 401 "Invalid API key" âŒ
Ce qu'on a testÃ©

âœ… VÃ©rifiÃ© que la clÃ© existe en base et correspond au hash (bcrypt.compare = true)
âœ… TestÃ© avec la clÃ© en dur dans N8N (pas de variable)
âœ… TestÃ© avec l'URL en dur dans N8N
âœ… SupprimÃ© le doublon Content-Type
âœ… RecrÃ©Ã© le header Authorization manuellement
âœ… VÃ©rifiÃ© qu'il n'y a pas d'espace avant/aprÃ¨s la clÃ©

Headers envoyÃ©s par N8N
json{
  "content-type": "application/json",
  "authorization": "Bearer speedai_live_238bc33272d57033cb5b0536f1d5db7ab839d591c440ec876ef06f480ff43205",
  "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7"
}
HypothÃ¨ses

User-Agent diffÃ©rent - N8N envoie un User-Agent diffÃ©rent de curl, peut-Ãªtre bloquÃ© ?
Headers supplÃ©mentaires - N8N ajoute des headers (accept, etc.) qui perturbent le middleware ?
Encoding du header - DiffÃ©rence d'encoding entre curl et N8N ?
IP/Origin bloquÃ© - N8N Cloud a une IP diffÃ©rente ?

Demande
Peux-tu :

Logger les headers complets reÃ§us par /api/webhooks/n8n pour voir la diffÃ©rence entre curl et N8N ?
VÃ©rifier le middleware requireApiKey pour voir s'il y a une condition qui rejette certaines requÃªtes ?
Ajouter un log pour afficher la clÃ© API extraite avant la comparaison bcrypt ?